var builtinComponents=[{name:"Effect List",code:4294967294,group:"",func:"effectList"},{name:"Simple",code:0,group:"Render",func:"simple"},{name:"Dot Plane",code:1,group:"Render",func:"generic",fields:{rotationSpeed:"Int32",colorTop:"Color",colorHigh:"Color",colorMid:"Color",colorLow:"Color",colorBottom:"Color",angle:"Int32",null0:sizeInt}},{name:"Oscilliscope Star",code:2,group:"Render",func:"generic",fields:{audioChannel:["Bit",[2,3],"AudioChannel"],positionX:["Bit",[4,5],"PositionX"],null0:sizeInt-1,colors:"ColorList",size:sizeInt,rotation:sizeInt}},{name:"FadeOut",code:3,group:"Trans",func:"generic",fields:{speed:sizeInt,color:["Color",sizeInt]}},{name:"Blitter Feedback",code:4,group:"Misc",func:"generic",fields:{zoom:sizeInt,onBeatZoom:sizeInt,output:["Map4",{0:"Replace",1:"50/50"}],onBeat:["Bool",sizeInt],bilinear:["Bool",sizeInt]}},{name:"OnBeat Clear",code:5,group:"Render",func:"generic",fields:{color:"Color",output:["Map4",{0:"Replace",1:"50/50"}],clearBeats:sizeInt}},{name:"Blur",code:6,group:"Trans",func:"generic",fields:{blur:["Map4",{0:"None",1:"Medium",2:"Light",3:"Heavy"}],round:["Map4",{0:"Down",1:"Up"}]}},{name:"Bass Spin",code:7,group:"Trans",func:"generic",fields:{enabledLeft:["Bit",0,"Boolified"],enabledRight:["Bit",1,"Boolified"],null0:sizeInt-1,colorLeft:"Color",colorRight:"Color",mode:["Map4",{0:"Lines",1:"Triangles"}]}},{name:"Moving Particle",code:8,group:"Render",func:"generic",fields:{enabled:["Bit",0,"Boolified"],onBeatSizeChange:["Bit",1,"Boolified"],null0:sizeInt-1,color:"Color",range:sizeInt,size:sizeInt,onBeatSize:sizeInt,output:["Map4",{0:"Replace",1:"Additive",2:"50/50",3:"Default"}]}},{name:"SVP",code:10,group:"Render",func:"generic",fields:{library:["SizeString",260]}},{name:"Colorfade",code:11,group:"Trans",func:"generic",fields:{enabled:["Bit",0,"Boolified"],onBeat:["Bit",2,"Boolified"],onBeatRandom:["Bit",1,"Boolified"],null0:sizeInt-1,fader1:"Int32",fader2:"Int32",fader3:"Int32",beatFader1:"Int32",beatFader2:"Int32",beatFader3:"Int32"}},{name:"Color Clip",code:12,group:"Trans",func:"generic",fields:{mode:["Map4",{0:"Off",1:"Below",2:"Above",3:"Near"}],colorFrom:"Color",colorTo:"Color",colorDistance:sizeInt}},{name:"Rotating Stars",code:13,group:"Render",func:"generic",fields:{colors:"ColorList"}},{name:"Ring",code:14,group:"Render",func:"generic",fields:{audioChannel:["Bit",[2,3],"AudioChannel"],positionX:["Bit",[4,5],"PositionX"],null0:sizeInt-1,colors:"ColorList",size:sizeInt,audioSource:["UInt32",sizeInt,"AudioSource"]}},{name:"Movement",code:15,group:"Trans",func:"movement"},{name:"Scatter",code:16,group:"Trans",func:"generic",fields:{enabled:["Bool",sizeInt]}},{name:"Dot Grid",code:17,group:"Render",func:"generic",fields:{colors:"ColorList",spacing:sizeInt,speedX:"Int32",speedY:"Int32",output:["Map4",{0:"Replace",1:"Additive",2:"50/50",3:"Default"}]}},{name:"Buffer Save",code:18,group:"Misc",func:"generic",fields:{mode:["BufferMode",sizeInt],buffer:["BufferNum",sizeInt],blend:["BlendmodeBuffer",sizeInt],adjustBlend:sizeInt}},{name:"Dot Fountain",code:19,group:"Render",func:"generic",fields:{rotationSpeed:"Int32",colorTop:"Color",colorHigh:"Color",colorMid:"Color",colorLow:"Color",colorBottom:"Color",angle:"Int32",null0:sizeInt}},{name:"Water",code:20,group:"Trans",func:"generic",fields:{enabled:["Bool",sizeInt]}},{name:"Comment",code:21,group:"Misc",func:"generic",fields:{text:"SizeString"}},{name:"Brightness",code:22,group:"Trans",func:"generic",fields:{enabled:["Bool",sizeInt],output:["Map8",{0:"Replace",1:"Additive",4294967296:"50/50"}],red:"Int32",green:"Int32",blue:"Int32",separate:["Bool",sizeInt],excludeColor:"Color",exclude:["Bool",sizeInt],distance:sizeInt}},{name:"Interleave",code:23,group:"Trans",func:"generic",fields:{enabled:["Bool",sizeInt],x:sizeInt,y:sizeInt,color:"Color",output:["Map8",{0:"Replace",1:"Additive",4294967296:"50/50"}],onbeat:["Bool",sizeInt],x2:sizeInt,y2:sizeInt,beatDuration:sizeInt}},{name:"Grain",code:24,group:"Trans",func:"generic",fields:{enabled:["Bool",sizeInt],output:["Map8",{0:"Replace",1:"Additive",4294967296:"50/50"}],amount:sizeInt,"static":["Bool",sizeInt]}},{name:"Clear Screen",code:25,group:"Render",func:"generic",fields:{enabled:["Bool",sizeInt],color:["Color",sizeInt],output:["Map8",{0:"Replace",1:"Additive",4294967296:"50/50"}],onlyFirst:["Bool",sizeInt]}},{name:"Mirror",code:26,group:"Trans",func:"generic",fields:{enabled:["Bool",sizeInt],topToBottom:["Bit",0,"Boolified"],bottomToTop:["Bit",1,"Boolified"],leftToRight:["Bit",2,"Boolified"],rightToLeft:["Bit",3,"Boolified"],null0:sizeInt-1,onBeat:["Bool",sizeInt],smooth:["Bool",sizeInt],speed:sizeInt}},{name:"Starfield",code:27,group:"Render",func:"generic",fields:{enabled:sizeInt,color:"Color",output:["Map8",{0:"Replace",1:"Additive",4294967296:"50/50"}],WarpSpeed:["Float32",sizeInt],MaxStars_set:sizeInt,onbeat:sizeInt,spdBeat:["Float32",sizeInt],durFrames:sizeInt}},{name:"Text",code:28,group:"Render",func:"generic",fields:{enabled:["Bool",sizeInt],color:["Color",sizeInt],output:["Map8",{0:"Replace",1:"Additive",4294967296:"50/50"}],onBeat:["Bool",sizeInt],insertBlanks:["Bool",sizeInt],randomPosition:["Bool",sizeInt],verticalAlign:["Map4",{"0":"Top","4":"Center","8":"Bottom"}],horizontalAlign:["Map4",{"0":"Left","1":"Center","2":"Right"}],onBeatSpeed:sizeInt,normSpeed:sizeInt,null0:60,null1:sizeInt*4,weight:["Map4",{"0":"Dontcare","100":"Thin","200":"Extralight","200":"Ultralight","300":"Light","400":"Normal","400":"Regular","500":"Medium","600":"Semibold","600":"Demibold","700":"Bold","800":"Extrabold","800":"Ultrabold","900":"Heavy","900":"Black"}],italic:["Bool",1],underline:["Bool",1],strikeOut:["Bool",1],charSet:1,null2:4,fontName:["SizeString",32],text:["SizeString",0,"SemiColSplit"],outline:["Bool",sizeInt],outlineColor:"Color",shiftX:sizeInt,shiftY:sizeInt,outlineShadowSize:sizeInt,randomWord:["Bool",sizeInt],shadow:["Bool",sizeInt]}},{name:"Bump",code:29,group:"Trans",func:"generic",fields:{enabled:["Bool",sizeInt],onBeat:["Bool",sizeInt],duration:sizeInt,depth:sizeInt,onBeatDepth:sizeInt,output:["Map8",{0:"Replace",1:"Additive",4294967296:"50/50"}],code:"CodeFBI",showDot:["Bool",sizeInt],invertDepth:["Bool",sizeInt],null0:sizeInt,depthBuffer:["BufferNum",sizeInt]}},{name:"Mosaic",code:30,group:"Trans",func:"generic",fields:{enabled:["Bool",sizeInt],size:sizeInt,sizeOnBeat:sizeInt,output:["Map8",{0:"Replace",1:"Additive",4294967296:"50/50"}],onbeat:["Bool",sizeInt],durFrames:sizeInt}},{name:"Water Bump",code:31,group:"Trans",func:"generic",fields:{enabled:["Bool",sizeInt],density:sizeInt,depth:sizeInt,random:["Bool",sizeInt],dropPositionX:sizeInt,dropPositionY:sizeInt,dropRadius:sizeInt,method:sizeInt}},{name:"AVI",code:32,group:"Trans",func:"avi"},{name:"Custom BPM",code:33,group:"Misc",func:"generic",fields:{enabled:["Bool",sizeInt],mode:["RadioButton",{0:"Arbitrary",1:"Skip",2:"Reverse"}],arbitraryValue:sizeInt,skipValue:sizeInt,skipFirstBeats:sizeInt}},{name:"Picture",code:34,group:"Render",func:"generic",fields:{enabled:["Bool",sizeInt],output:["Map8",{0:"Replace",1:"Additive",4294967296:"50/50"}],adapt:sizeInt,onBeatPersist:sizeInt,file:"NtString",ratio:sizeInt,aspectRatioAxis:["Map4",{0:"X",1:"Y"}]}},{name:"Dynamic Distance Modifier",code:35,group:"Trans",func:"generic",fields:{null0:1,code:"CodePFBI",output:["Map4",{0:"Replace",1:"50/50"}],bilinear:["Bool",sizeInt]}},{name:"Super Scope",code:36,group:"Render",func:"generic",fields:{version:["Bool",1],code:"CodePFBI",audioChannel:["Bit",[0,1],"AudioChannel"],audioSource:["Bit",2,"AudioSource"],null0:3,colors:"ColorList",lineType:["DrawMode",sizeInt]}},{name:"Invert",code:37,group:"Trans",func:"generic",fields:{enabled:["Bool",sizeInt]}},{name:"Unique Tone",code:38,group:"Trans",func:"generic",fields:{enabled:["Bool",sizeInt],color:"Color",output:["Map8",{0:"Replace",1:"Additive",4294967296:"50/50"}],invert:["Bool",sizeInt]}},{name:"Timescope",code:39,group:"Render",func:"generic",fields:{enabled:["Bool",sizeInt],color:"Color",output:["Map8",{0:"Replace",1:"Additive",4294967296:"50/50",2:"Default"}],audioChannel:["UInt32",sizeInt,"AudioChannel"],bands:sizeInt}},{name:"Set Render Mode",code:40,group:"Misc",func:"generic",fields:{blend:["BlendmodeRender",1],adjustBlend:1,lineSize:1,enabled:["Bit",7,"Boolified"]}},{name:"Interference",code:41,group:"Trans",func:"generic",fields:{enabled:["Bool",sizeInt],numberOfLayers:sizeInt,null0:sizeInt,distance:sizeInt,alpha:sizeInt,rotation:"Int32",output:["Map8",{0:"Replace",1:"Additive",4294967296:"50/50"}],onBeatDistance:sizeInt,onBeatAlpha:sizeInt,onBeatRotation:sizeInt,separateRGB:["Bool",sizeInt],onBeat:["Bool",sizeInt],speed:"Float32"}},{name:"Dynamic Shift",code:42,group:"Trans",func:"generic",fields:{version:["Bool",1],code:"CodeIFB",output:["Map4",{0:"Replace",1:"50/50"}],bilinear:["Bool",sizeInt]}},{name:"Dynamic Movement",code:43,group:"Trans",func:"generic",fields:{version:["Bool",1],code:"CodePFBI",bilinear:["Bool",sizeInt],coordinates:["Coordinates",sizeInt],gridW:sizeInt,gridH:sizeInt,alpha:["Bool",sizeInt],wrap:["Bool",sizeInt],buffer:["BufferNum",sizeInt],alphaOnly:["Bool",sizeInt]}},{name:"Fast Brightness",code:44,group:"Trans",func:"generic",fields:{factor:["Map4",{0:2,1:0.5,2:1}]}},{name:"Color Modifier",code:45,group:"Trans",func:"generic",fields:{recomputeEveryFrame:["Bool",1],code:"CodePFBI"}}];var dllComponents=[{name:"AVS Trans Automation",code:[77,105,115,99,58,32,65,86,83,84,114,97,110,115,32,65,117,116,111,109,97,116,105,111,110,0,0,0,0,0,0,0],group:"Misc",func:"generic",fields:{enabled:["Bool",sizeInt],logging:["Bool",sizeInt],translateFirstLevel:["Bool",sizeInt],readCommentCodes:["Bool",sizeInt],code:"NtString"}},{name:"Texer II",code:[65,99,107,111,46,110,101,116,58,32,84,101,120,101,114,32,73,73,0,0,0,0,0,0,0,0,0,0,0,0,0,0],group:"Render",func:"generic",fields:{null0:sizeInt,image:["SizeString",260],resizing:["Bool",sizeInt],wrap:["Bool",sizeInt],coloring:["Bool",sizeInt],null1:sizeInt,code:"CodeIFBP"}},{name:"Color Map",code:[67,111,108,111,114,32,77,97,112,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],group:"Trans",func:"generic",fields:{key:["KeyColorMap",sizeInt],output:["BlendmodeColorMap",sizeInt],mapCycling:["CycleModeColorMap",sizeInt],null0:2,dontSkipFastBeats:["Bool",1],cycleSpeed:1,maps:"ColorMaps"}},{name:"Framerate Limiter",code:[86,70,88,32,70,82,65,77,69,82,65,84,69,32,76,73,77,73,84,69,82,0,0,0,0,0,0,0,0,0,0,0],group:"Misc",func:"generic",fields:{enabled:["Bool",sizeInt],limit:sizeInt}},{name:"Convolution Filter",code:[72,111,108,100,101,110,48,51,58,32,67,111,110,118,111,108,117,116,105,111,110,32,70,105,108,116,101,114,0,0,0,0],group:"Misc",func:"generic",fields:{enabled:["Bool",sizeInt],wrap:["Bool",sizeInt],absolute:["Bool",sizeInt],"2-pass":["Bool",sizeInt],kernel:["ConvoFilter",[7,7]],bias:["Bool",sizeInt],scaling:["Bool",sizeInt]}},{name:"Triangle",code:[82,101,110,100,101,114,58,32,84,114,105,97,110,103,108,101,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],group:"Misc",func:"generic",fields:{code:"NtCodeIFBP"}},{name:"Channel Shift",code:[67,104,97,110,110,101,108,32,83,104,105,102,116,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],group:"Misc",func:"generic",fields:{mode:["Map4",{1144:"RGB",1020:"RBG",1019:"BRG",1021:"BGR",1018:"GBR",1022:"GRB"}],onBeatRandom:["Bool",sizeInt]}},{name:"Normalize",code:[84,114,97,110,115,58,32,78,111,114,109,97,108,105,115,101,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],group:"Trans",func:"generic",fields:{enabled:["Bool",sizeInt]}},{name:"Video Delay",code:[72,111,108,100,101,110,48,52,58,32,86,105,100,101,111,32,68,101,108,97,121,0,0,0,0,0,0,0,0,0,0,0],group:"Trans",func:"generic",fields:{enabled:["Bool",sizeInt],useBeats:["Bool",sizeInt],delay:sizeInt}},{name:"Multiplier",code:[77,117,108,116,105,112,108,105,101,114,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],group:"Trans",func:"generic",fields:{multiply:["Map4",{0:"Infinite Root",1:8,2:4,3:2,4:0.5,5:0.25,6:0.125,7:"Infinite Square"}]}},{name:"Color Reduction",code:[67,111,108,111,114,32,82,101,100,117,99,116,105,111,110,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],group:"Trans",func:"generic",fields:{null0:260,colors:["Map4",{1:2,2:4,3:8,4:16,5:32,6:64,7:128,8:256}]}},{name:"Multi Delay",code:[72,111,108,100,101,110,48,53,58,32,77,117,108,116,105,32,68,101,108,97,121,0,0,0,0,0,0,0,0,0,0,0],group:"Trans",func:"generic",fields:{mode:["Map4",{0:"Disabled",1:"Input",2:"Output"}],activeBuffer:sizeInt,useBeats0:["Bool",sizeInt],delay0:sizeInt,useBeats1:["Bool",sizeInt],delay1:sizeInt,useBeats2:["Bool",sizeInt],delay2:sizeInt,useBeats3:["Bool",sizeInt],delay3:sizeInt,useBeats4:["Bool",sizeInt],delay4:sizeInt,useBeats5:["Bool",sizeInt],delay5:sizeInt}},{name:"MIDI Trace",code:[78,117,108,108,115,111,102,116,32,80,105,120,101,108,99,111,114,112,115,58,32,77,73,68,73,116,114,97,99,101,32,0],group:"Misc",func:"generic",fields:{enabled:["Bool",sizeInt],channels:sizeInt,mode:["Map32",{1:"Current",2:"Trigger"}],allChannels:["Bool",sizeInt],printEvents:["Bool",sizeInt]}},{name:"Add Borders",code:[86,105,114,116,117,97,108,32,69,102,102,101,99,116,58,32,65,100,100,98,111,114,100,101,114,115,0,0,0,0,0,0],group:"Misc",func:"generic",fields:{enabled:["Bool",sizeInt],color:"Color",size:sizeInt}},{name:"AVI Player",code:[86,70,88,32,65,86,73,32,80,76,65,89,69,82,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],group:"Misc",func:"generic",fields:{filePath:["SizeString",256],enabled:["Bool",sizeInt]}},{name:"FyrewurX",code:[70,117,110,107,121,70,88,32,70,121,114,101,119,117,114,88,32,118,49,0,0,0,0,0,0,0,0,0,0,0,0,0],group:"Misc",func:"generic",fields:{enabled:["Bool",sizeInt]}},{name:"Global Variables",code:[74,104,101,114,105,107,111,58,32,71,108,111,98,97,108,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],group:"Misc",func:"generic",fields:{load:["Map4",{0:"None",1:"Once",2:"CodeControl",3:"EveryFrame"}],null0:sizeInt*6,code:"NtCodeIFB",file:"NtString",saveRegRange:"NtString",saveBufRange:"NtString"}},{name:"Fluid",code:[71,101,105,115,115,70,108,117,105,100,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],group:"Misc",func:"generic",fields:{null0:sizeInt}}];var componentTable=builtinComponents.concat(dllComponents);function convertPreset(g,c){var f={name:c.name.substr(0,c.name.length-4),date:c.lastModifiedDate.toISOString()};var b=new Uint8Array(g);try{var a=decodePresetHeader(b.subarray(0,presetHeaderLength));f.clearFrame=a;var d=convertComponents(b.subarray(presetHeaderLength));f.components=d}catch(h){if(h instanceof ConvertException){log("Error: "+h.message);return null}else{throw h}}return f}function convertComponents(a){var h=0;var f=[];while(h<a.length){var b=getUInt32(a,h);var e=getComponentIndex(b,a,h);var d=b!==4294967294&&b>builtinMax;var j=getComponentSize(a,h+sizeInt+d*32);if(e<0){var g={type:"Unknown: ("+(-e)+")"}}else{var c=h+sizeInt*2+d*32;var g=window["decode_"+componentTable[e].func](a,c,componentTable[e].fields,componentTable[e].name,c+j)}if(!g||typeof g!=="object"){throw new ConvertException("Unknown convert error")}f.push(g);h+=j+sizeInt*2+d*32}return f}function getComponentIndex(c,a,d){if(c<builtinMax||c===4294967294){for(var b=0;b<componentTable.length;b++){if(c===componentTable[b].code){log("Found component: "+componentTable[b].name+" ("+c+")");return b}}}else{for(var b=builtinComponents.length;b<componentTable.length;b++){if(componentTable[b].code instanceof Array&&cmpBytes(a,d+sizeInt,componentTable[b].code)){log("Found component: "+componentTable[b].name);return b}}}log("Found unknown component (code: "+c+")");return -c}function getComponentSize(a,b){return getUInt32(a,b)}function decodePresetHeader(a){var c=[78,117,108,108,115,111,102,116,32,65,86,83,32,80,114,101,115,101,116,32,48,46,49,26];var b=[78,117,108,108,115,111,102,116,32,65,86,83,32,80,114,101,115,101,116,32,48,46,50,26];if(!cmpBytes(a,0,b)&&!cmpBytes(a,0,c)){throw new ConvertException("Invalid preset header.")}return a[presetHeaderLength-1]===1}function decode_effectList(a,e){var k=getUInt32(a,e-sizeInt);var g={type:"EffectList",enabled:getBit(a,e,1)[0]!==1,clearFrame:getBit(a,e,0)[0]===1,input:getBlendmodeIn(a,e+2,1)[0],output:getBlendmodeOut(a,e+3,1)[0],inAdjustBlend:getUInt32(a,e+5),outAdjustBlend:getUInt32(a,e+9),inBuffer:getUInt32(a,e+13),outBuffer:getUInt32(a,e+17),inBufferInvert:getUInt32(a,e+21)===1,outBufferInvert:getUInt32(a,e+25)===1,enableOnBeat:getUInt32(a,e+29)===1,onBeatFrames:getUInt32(a,e+33)};var b=[0,64,0,0,65,86,83,32,50,46,56,43,32,69,102,102,101,99,116,32,76,105,115,116,32,67,111,110,102,105,103,0,0,0,0,0];var i=e+37;var f=k-37;var c=i;if(cmpBytes(a,i,b)){i+=b.length;var j=getUInt32(a,i);c+=b.length+sizeInt+j;f=k-37-b.length-sizeInt-j;g.codeEnabled=getUInt32(a,i+sizeInt)===1;var d=getUInt32(a,i+sizeInt*2);g.init=getSizeString(a,i+sizeInt*2)[0];g.frame=getSizeString(a,i+sizeInt*3+d)[0]}var h=convertComponents(a.subarray(c,c+f));g.components=h;return g}function decode_generic(a,g,n,v,c){var t={type:removeSpaces(v)};var l=Object.keys(n);var u=false;for(var q=0;q<l.length;q++){if(g>=c){break}var p=l[q];var r=n[p];if(p.match(/^null[_0-9]*$/)){g+=r;u=false;continue}var m=0;var o,j;var b=typeof r==="number";var d=typeof r==="string";var h=r instanceof Array;if(b){switch(r){case 1:m=1;o=a[g];break;case sizeInt:m=sizeInt;o=getUInt32(a,g);break;default:throw new ConvertException("Invalid field size: "+r+".")}u=false}else{if(d){try{j=window["get"+r](a,g)}catch(s){if(s.message.search(/has no method'/)>=0){throw new ConvertException("Method '"+r+"' was not found. (correct capitalization?)")}else{throw s}}o=j[0];m=j[1];u=false}else{if(r&&r.length>=2){if(r[0]==="Bit"){if(u){g-=1}u=true}else{u=false}try{j=window["get"+r[0]](a,g,r[1]);o=j[0];if(r[2]){o=window["get"+r[2]](o)}}catch(s){if(s.message.search(/has no method/)>=0){throw new ConvertException("Method '"+r+"' was not found. (correct capitalization?)")}else{throw s}}m=j[1]}}}t[p]=o;if(verbose){log("k: "+p+", val: "+o+", offset: "+g)}g+=m}return t}function decode_movement(c,g){var b={type:"Movement"};var f=getUInt32(c,g);var d=[];var e;if(f!==0){if(f===32767){var h=getSizeString(c,g+sizeInt+1);g+=h[1];e=h[0]}else{d=movementEffects[f]}}else{var a=getUInt32(c,g+sizeInt*6);d=movementEffects[a]}if(d.length){b.builtinEffect=d[0]}b.output=getUInt32(c,g+sizeInt)?"50/50":"Replace";b.sourceMapped=getBool(c,g+sizeInt*2,sizeInt)[0];b.coordinates=getCoordinates(c,g+sizeInt*3,sizeInt);b.bilinear=getBool(c,g+sizeInt*4,sizeInt)[0];b.wrap=getBool(c,g+sizeInt*5,sizeInt)[0];if(d.length&&f!==1&&f!==7){e=d[1];b.coordinates=d[2]}b.code=e;return b}function decode_avi(b,d){var a={type:"AVI",enabled:getBool(b,d,sizeInt)[0]};var e=getNtString(b,d+sizeInt*3);a.file=e[0];a.speed=getUInt32(b,d+sizeInt*5+e[1]);var c=getUInt32(b,d+sizeInt*3+e[1]);if(c){a.output="50/50"}else{a.output=getMap8(b,d+sizeInt,{0:"Replace",1:"Additive",4294967296:"50/50"})}a.onBeatAdd=c;a.persist=getUInt32(b,d+sizeInt*4+e[1]);return a}function decode_simple(b,d){var a={type:"Simple"};var c=getUInt32(b,d);if(c&(1<<6)){a.audioSource=(c&2)?"Waveform":"Spectrum";a.renderType="Dots"}else{switch(c&3){case 0:a.audioSource="Spectrum";a.renderType="Solid";break;case 1:a.audioSource="Spectrum";a.renderType="Lines";break;case 2:a.audioSource="Waveform";a.renderType="Lines";break;case 3:a.audioSource="Waveform";a.renderType="Solid";break}}a.audioChannel=getAudioChannel((c>>2)&3);a.positionY=getPositionY((c>>4)&3);a.colors=getColorList(b,d+sizeInt)[0];return a}function getMap1(a,c,b){return[getMapping(b,a[c]),1]}function getMap4(a,c,b){return[getMapping(b,getUInt32(a,c)),sizeInt]}function getMap8(a,c,b){return[getMapping(b,getUInt64(a,c)),sizeInt*2]}function getRadioButton(b,f,e){var d=0;for(var c=0;c<e.length;c++){var a=getUInt32(b,f+sizeInt*c)!==0;if(a){d=a*(c+1)}}return[getMapping(e,d),sizeInt*e.length]}function getMapping(c,a){var b=c[a];if(b===undefined){throw new ConvertException("Map: A value for key '"+a+"' does not exist.")}else{return b}}function getCodePFBI(a,c){var b=[["init",3],["perFrame",1],["onBeat",2],["perPoint",0]];return getCodeSection(a,c,b)}function getCodeFBI(a,c){var b=[["init",2],["perFrame",1],["onBeat",0]];return getCodeSection(a,c,b)}function getCodeIFBP(a,c){var b=[["init",0],["perFrame",1],["onBeat",2],["perPoint",3]];return getCodeSection(a,c,b)}function getCodeIFB(a,c){var b=[["init",0],["perFrame",1],["onBeat",2]];return getCodeSection(a,c,b)}function getNtCodeIFB(a,c){var b=[["init",0],["perFrame",1],["onBeat",2]];return getCodeSection(a,c,b,true)}function getNtCodeIFBP(a,c){var b=[["init",0],["perFrame",1],["onBeat",2],["perPoint",3]];return getCodeSection(a,c,b,true)}function getCodeSection(a,e,b,h){var k=new Array(b.length);var j=0;for(var f=0,d=e;f<b.length;f++,d+=g[1]){var g=h?getNtString(a,d):getSizeString(a,d);j+=g[1];k[f]=g[0]}var c={};for(var f=0;f<k.length;f++){c[b[f][0]]=k[b[f][1]]}return[c,j]}function getColorList(b,e){var a=[];var c=getUInt32(b,e);var d=sizeInt+c*sizeInt;while(c>0){e+=sizeInt;a.push(getColor(b,e)[0]);c--}return[a,d]}function getColorMaps(a,e){var c=e+480;var l=[];var j=60;var h=0;for(var f=0;f<8;f++){var k=getBool(a,e+j*f,sizeInt)[0];var g=getUInt32(a,e+j*f+sizeInt);var b=getColorMap(a,c,g);if(!k&&b.length===2&&b[0].color==="#000000"&&b[0].position===0&&b[1].color==="#ffffff"&&b[1].position===255){}else{l[h]={index:f,enabled:k};if(allFields){var d=getUInt32(a,e+j*f+sizeInt*2);var m=getNtString(a,e+j*f+sizeInt*3)[0];l[h]["id"]=d;l[h]["fileName"]=m}l[h]["map"]=b;h++}c+=g*sizeInt*3}return[l,c-e]}function getColorMap(b,f,d){var c=[];for(var e=0;e<d;e++){var g=getUInt32(b,f);var a=getColor(b,f+sizeInt)[0];f+=sizeInt*3;c[e]={color:a,position:g}}return c}function getColor(b,e){var a=getUInt32(b,e).toString(16);var d="";for(var c=a.length;c<6;c++){d+="0"}return["#"+d+a,sizeInt]}function getConvoFilter(b,g,e){if(!(e instanceof Array)&&e.length!==2){throw new ConvertException("ConvoFilter: Size must be array with x and y dimensions in dwords.")}var d=e[0]*e[1];var f=new Array(d);for(var c=0;c<d;c++,g+=sizeInt){f[c]=getInt32(b,g)[0]}var a={width:e[0],height:e[1],data:f};return[a,d*sizeInt]}function getSemiColSplit(b){var a=b.split(";");if(a.length===1){return a[0]}else{return a}}function getBlendmodeIn(a,d,b){var c=b===1?a[d]:getUInt32(a,d);return[blendmodesIn[c],b]}function getBlendmodeOut(a,d,b){var c=b===1?a[d]:getUInt32(a,d);return[blendmodesOut[c],b]}function getBlendmodeBuffer(a,d,b){var c=b===1?a[d]:getUInt32(a,d);return[blendmodesBuffer[c],b]}function getBlendmodeRender(a,d,b){var c=b===1?a[d]:getUInt32(a,d);return[blendmodesRender[c],b]}function getBlendmodeColorMap(a,d,b){var c=b===1?a[d]:getUInt32(a,d);return[blendmodesColorMap[c],b]}function getKeyColorMap(a,d,b){var c=b===1?a[d]:getUInt32(a,d);return[keysColorMap[c],b]}function getCycleModeColorMap(a,d,b){var c=b===1?a[d]:getUInt32(a,d);return[cycleModesColorMap[c],b]}function getBufferMode(a,d,b){var c=b===1?a[d]:getUInt32(a,d);return[buffermodes[c],b]}function getBufferNum(a,d,b){var c=b===1?a[d]:getUInt32(a,d);if(c===0){return["Current",b]}else{return[getUInt32(a,d),b]}}function getCoordinates(a,d,b){var c=b===1?a[d]:getUInt32(a,d);return[coordinates[c],b]}function getDrawMode(a,d,b){var c=b===1?a[d]:getUInt32(a,d);return[drawModes[c],b]}function getAudioChannel(a){return audioChannels[a]}function getAudioSource(a){return audioSources[a]}function getPositionX(a){return positionsX[a]}function getPositionY(a){return positionsY[a]}function checkCompat(){if(window.File&&window.FileReader&&window.FileList&&window.Blob){compat=true}else{compat=false}}function loadDir(c,e){var a=c.files;var d=[];for(var b=0;b<a.length;b++){if(e.test(a[b].name)){d.push(a[b])}}return d}function loadFile(b,c){if(!b instanceof File){log("Error: 'file' parameter is no file.");return false}if(typeof c!=="function"){log("Error: 'callback' parameter is no function.");return false}log("Loading file "+b.name+"... ");var a=new FileReader();a.onloadend=function(d){if(d.target.readyState==FileReader.DONE){c(d.target.result,b)}};a.readAsArrayBuffer(b)}var compat=false;var outputDir="";var pedanticMode=false;var verbose=true;var allFields=true;var prettyPrint=true;$(document).ready(function(){checkCompat();log("File API check: "+(compat?"success":"fail")+".");var a=[];$("#preset").change(function(){a=loadDir(this,/\.avs$/);log("Found "+a.length+" files in directory.");for(var b=0;b<a.length;b++){loadFile(a[b],saveAvsAsJson)}})});function saveAvsAsJson(d,c){var b=convertPreset(d,c);var a=("#output");$(a).html(JSON.stringify(b,null,prettyPrint?"    ":null));$(a).each(function(f,g){hljs.highlightBlock(g)})}function jsonPrintSpecials(b,a){if(b==="convolutionMatrix"){return a.join(",")}return a}var sizeInt=4;var presetHeaderLength=25;var builtinMax=16384;function log(a){$("#log").prepend(a+"\n")}function ConvertException(a){this.message=a;this.name="ConvertException"}function cmpBytes(a,c,d){for(var b=0;b<d.length;b++){if(d[b]===null){continue}if(a[b+c]!==d[b]){return false}}return true}function getBit(b,c,d){if(d instanceof Array){if(d.length!==2){new ConvertException("Wrong Bitfield range")}var a=(2<<(d[1]-d[0]))-1;return[(b[c]>>d[0])&a,1]}else{return[((b[c]>>d)&1),1]}}function getUInt32(a,b){if(!b){b=0}var c=a.buffer.slice(a.byteOffset+b,a.byteOffset+b+sizeInt);return new Uint32Array(c,0,1)[0]}function getInt32(a,b){if(!b){b=0}var c=a.buffer.slice(a.byteOffset+b,a.byteOffset+b+sizeInt);return[new Int32Array(c,0,1)[0],4]}function getUInt64(b,c){if(!c){c=0}var d=b.buffer.slice(b.byteOffset+c,b.byteOffset+c+sizeInt*2);var a=new Uint32Array(d,0,2);return a[0]+a[1]*4294967296}function getFloat32(a,b){if(!b){b=0}var c=a.buffer.slice(a.byteOffset+b,a.byteOffset+b+sizeInt);return[new Float32Array(c,0,1)[0],4]}function getBool(a,d,b){var c=b===1?a[d]:getUInt32(a,d);return[c!==0,b]}function getBoolified(a){return a==0?false:true}function getSizeString(d,h,f){var g=0;var a="";if(!f){f=getUInt32(d,h);g=sizeInt}var b=h+f+g;var e=h+g;var j=d[e];while(j>0&&e<b){a+=String.fromCharCode(j);j=d[++e]}return[a,f+g]}function getNtString(b,e){var a="";var d=e;var f=b[d];while(f>0){a+=String.fromCharCode(f);f=b[++d]}return[a,d-e+1]}function removeSpaces(a){return a.replace(/[ ]/g,"")}var blendmodesIn={"0":"Ignore","1":"Replace","2":"50/50","3":"Maximum","4":"Additive","5":"Dest-Src","6":"Src-Dest","7":"EveryOtherLine","8":"EveryOtherPixel","9":"XOR","10":"Adjustable","11":"Multiply","12":"Buffer"};var blendmodesOut={"0":"Replace","1":"Ignore","2":"Maximum","3":"50/50","4":"Dest-Src","5":"Additive","6":"EveryOtherLine","7":"Src-Dest","8":"XOR","9":"EveryOtherPixel","10":"Multiply","11":"Adjustable","13":"Buffer"};var blendmodesBuffer={"0":"Replace","1":"50/50","2":"Additive","5":"EveryOtherPixel","4":"Dest-Src","5":"EveryOtherLine","6":"XOR","7":"Maximum","8":"Minimum","9":"Src-Dest","10":"Multiply","11":"Adjustable"};var blendmodesRender={"0":"Replace","1":"Additive","2":"Maximum","3":"50/50","4":"Dest-Src","5":"Src-Dest","6":"Multiply","7":"Adjustable","8":"XOR"};var blendmodesColorMap={"0":"Replace","1":"Additive","2":"Maximum","3":"50/50","4":"Dest-Src","5":"Src-Dest","6":"Multiply","7":"Adjustable","8":"XOR"};var keysColorMap={"0":"Red","1":"Green","2":"Blue","3":"(R+G+B)/2","4":"MaxChannel","5":"(R+G+B)/3"};var cycleModesColorMap={"0":"None (Map 1)","1":"OnBeat Random","2":"OnBeat Sequential"};var buffermodes={"0":"Save","1":"Restore","2":"AlternateSaveRestore","3":"AlternateRestoreSave"};var coordinates={"0":"Polar","1":"Cartesian"};var drawModes={"0":"Dots","1":"Lines"};var audioChannels={"0":"Left","1":"Right","2":"Center"};var audioSources={"0":"Waveform","1":"Spectrum"};var positionsX={"0":"Left","1":"Right","2":"Center"};var positionsY={"0":"Top","1":"Bottom","2":"Center"};var movementEffects={"0":["None","",0],"1":["Slight Fuzzify","",0],"2":["Shift Rotate Left","x=x+1/32; // use wrap for this one",1],"3":["Big Swirl Out","r = r + (0.1 - (0.2 * d));\r\nd = d * 0.96;",0],"4":["Medium Swirl","d = d * (0.99 * (1.0 - sin(r-$PI*0.5) / 32.0));\r\nr = r + (0.03 * sin(d * $PI * 4));",0],"5":["Sunburster","d = d * (0.94 + (cos((r-$PI*0.5) * 32.0) * 0.06));",0],"6":["Swirl To Center","d = d * (1.01 + (cos((r-$PI*0.5) * 4) * 0.04));\r\nr = r + (0.03 * sin(d * $PI * 4));",0],"7":["Blocky Partial Out","",0],"8":["Swirling Around Both Ways At Once","r = r + (0.1 * sin(d * $PI * 5));",0],"9":["Bubbling Outward","t = sin(d * $PI);\r\nd = d - (8*t*t*t*t*t)/sqrt((sw*sw+sh*sh)/4);",0],"10":["Bubbling Outward With Swirl","t = sin(d * $PI);\r\nd = d - (8*t*t*t*t*t)/sqrt((sw*sw+sh*sh)/4);\r\nt=cos(d*$PI/2.0);\r\nr= r + 0.1*t*t*t;",0],"11":["5 Pointed Distro","d = d * (0.95 + (cos(((r-$PI*0.5) * 5.0) - ($PI / 2.50)) * 0.03));",0],"12":["Tunneling","r = r + 0.04;\r\nd = d * (0.96 + cos(d * $PI) * 0.05);",0],"13":["Bleedin'","t = cos(d * $PI);\r\nr = r + (0.07 * t);\r\nd = d * (0.98 + t * 0.10);",0],"14":["Shifted Big Swirl Out","d=sqrt(x*x+y*y); r=atan2(y,x);\r\nr=r+0.1-0.2*d; d=d*0.96;\r\nx=cos(r)*d + 8/128; y=sin(r)*d;",0,1],"15":["Psychotic Beaming Outward","d = 0.15",0],"16":["Cosine Radial 3-way","r = cos(r * 3)",0],"17":["Spinny Tube","d = d * (1 - ((d - .35) * .5));\r\nr = r + .1;",0],"18":["Radial Swirlies","d = d * (1 - (sin((r-$PI*0.5) * 7) * .03));\r\nr = r + (cos(d * 12) * .03);",0],"19":["Swill","d = d * (1 - (sin((r - $PI*0.5) * 12) * .05));\r\nr = r + (cos(d * 18) * .05);\r\nd = d * (1-((d - .4) * .03));\r\nr = r + ((d - .4) * .13)",0],"20":["Gridley","x = x + (cos(y * 18) * .02);\r\ny = y + (sin(x * 14) * .03);",1],"21":["Grapevine","x = x + (cos(abs(y-.5) * 8) * .02);\r\ny = y + (sin(abs(x-.5) * 8) * .05);\r\nx = x * .95;\r\ny = y * .95;",1],"22":["Quadrant","y = y * ( 1 + (sin(r + $PI/2) * .3) );\r\nx = x * ( 1 + (cos(r + $PI/2) * .3) );\r\nx = x * .995;\r\ny = y * .995;",1],"23":["6-way Kaleida (use Wrap!)","y = (r*6)/($PI); x = d;",1]};hljs.initHighlightingOnLoad();function SelectText(b){var d=document;var e=d.getElementById(b);if(d.body.createTextRange){var a=d.body.createTextRange();a.moveToElementText(e);a.select()}else{if(window.getSelection){var c=window.getSelection();var a=d.createRange();a.selectNodeContents(e);c.removeAllRanges();c.addRange(a)}}}$(function(){$("#output").click(function(){SelectText("output")})});