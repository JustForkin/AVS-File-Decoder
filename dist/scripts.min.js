function log(message){$("#log").prepend(message+"\n")}function ConvertException(message){this.message=message,this.name="ConvertException"}function cmpBytes(arr,offset,test){for(var i=0;i<test.length;i++)if(null!==test[i]&&arr[i+offset]!==test[i])return!1;return!0}function getBit(blob,offset,pos){if(pos instanceof Array){2!==pos.length&&new ConvertException("Wrong Bitfield range");var mask=(2<<pos[1]-pos[0])-1;return[blob[offset]>>pos[0]&mask,1]}return[blob[offset]>>pos&1,1]}function getUInt32(blob,offset){offset||(offset=0);var array=blob.buffer.slice(blob.byteOffset+offset,blob.byteOffset+offset+sizeInt);return new Uint32Array(array,0,1)[0]}function getInt32(blob,offset){offset||(offset=0);var array=blob.buffer.slice(blob.byteOffset+offset,blob.byteOffset+offset+sizeInt);return[new Int32Array(array,0,1)[0],4]}function getUInt64(blob,offset){offset||(offset=0);var array=blob.buffer.slice(blob.byteOffset+offset,blob.byteOffset+offset+2*sizeInt),two32=new Uint32Array(array,0,2);return two32[0]+4294967296*two32[1]}function getFloat32(blob,offset){offset||(offset=0);var array=blob.buffer.slice(blob.byteOffset+offset,blob.byteOffset+offset+sizeInt);return[new Float32Array(array,0,1)[0],4]}function getBool(blob,offset,size){var val=1===size?blob[offset]:getUInt32(blob,offset);return[0!==val,size]}function getBoolified(num){return 0==num?!1:!0}function getSizeString(blob,offset,size){var add=0,result="";size||(size=getUInt32(blob,offset),add=sizeInt);for(var end=offset+size+add,i=offset+add,c=blob[i];c>0&&end>i;)result+=String.fromCharCode(c),c=blob[++i];return[result,size+add]}function getNtString(blob,offset){for(var result="",i=offset,c=blob[i];c>0;)result+=String.fromCharCode(c),c=blob[++i];return[result,i-offset+1]}function removeSpaces(str){return str.replace(/[ ]/g,"")}function checkCompat(){compat=window.File&&window.FileReader&&window.FileList&&window.Blob?!0:!1}function loadDir(element,pattern){for(var allfiles=element.files,files=[],i=0;i<allfiles.length;i++)pattern.test(allfiles[i].name)&&files.push(allfiles[i]);return files}function loadFile(file,callback){if(!file instanceof File)return log("Error: 'file' parameter is no file."),!1;if("function"!=typeof callback)return log("Error: 'callback' parameter is no function."),!1;log("Loading file "+file.name+"... ");var reader=new FileReader;reader.onloadend=function(e){e.target.readyState==FileReader.DONE&&callback(e.target.result,file)},reader.readAsArrayBuffer(file)}function convertPreset(presetFile,file){var preset={name:file.name.substr(0,file.name.length-4),date:file.lastModifiedDate.toISOString()},blob8=new Uint8Array(presetFile);try{var clearFrame=decodePresetHeader(blob8.subarray(0,presetHeaderLength));preset.clearFrame=clearFrame;var components=convertComponents(blob8.subarray(presetHeaderLength));preset.components=components}catch(e){if(e instanceof ConvertException)return log("Error: "+e.message),null;throw e}return preset}function convertComponents(blob){for(var fp=0,components=[];fp<blob.length;){var code=getUInt32(blob,fp),i=getComponentIndex(code,blob,fp),isDll=4294967294!==code&&code>builtinMax,size=getComponentSize(blob,fp+sizeInt+32*isDll);if(0>i)var res={type:"Unknown: ("+-i+")"};else var offset=fp+2*sizeInt+32*isDll,res=window["decode_"+componentTable[i].func](blob,offset,componentTable[i].fields,componentTable[i].name,offset+size);if(!res||"object"!=typeof res)throw new ConvertException("Unknown convert error");components.push(res),fp+=size+2*sizeInt+32*isDll}return components}function getComponentIndex(code,blob,offset){if(builtinMax>code||4294967294===code){for(var i=0;i<componentTable.length;i++)if(code===componentTable[i].code)return log("Found component: "+componentTable[i].name+" ("+code+")"),i}else for(var i=builtinComponents.length;i<componentTable.length;i++)if(componentTable[i].code instanceof Array&&cmpBytes(blob,offset+sizeInt,componentTable[i].code))return log("Found component: "+componentTable[i].name),i;return log("Found unknown component (code: "+code+")"),-code}function getComponentSize(blob,offset){return getUInt32(blob,offset)}function decodePresetHeader(blob){var presetHeader0_1=[78,117,108,108,115,111,102,116,32,65,86,83,32,80,114,101,115,101,116,32,48,46,49,26],presetHeader0_2=[78,117,108,108,115,111,102,116,32,65,86,83,32,80,114,101,115,101,116,32,48,46,50,26];if(!cmpBytes(blob,0,presetHeader0_2)&&!cmpBytes(blob,0,presetHeader0_1))throw new ConvertException("Invalid preset header.");return 1===blob[presetHeaderLength-1]}function decode_effectList(blob,offset){var size=getUInt32(blob,offset-sizeInt),comp={type:"EffectList",enabled:1!==getBit(blob,offset,1)[0],clearFrame:1===getBit(blob,offset,0)[0],input:getBlendmodeIn(blob,offset+2,1)[0],output:getBlendmodeOut(blob,offset+3,1)[0],inAdjustBlend:getUInt32(blob,offset+5),outAdjustBlend:getUInt32(blob,offset+9),inBuffer:getUInt32(blob,offset+13),outBuffer:getUInt32(blob,offset+17),inBufferInvert:1===getUInt32(blob,offset+21),outBufferInvert:1===getUInt32(blob,offset+25),enableOnBeat:1===getUInt32(blob,offset+29),onBeatFrames:getUInt32(blob,offset+33)},effectList28plusHeader=[0,64,0,0,65,86,83,32,50,46,56,43,32,69,102,102,101,99,116,32,76,105,115,116,32,67,111,110,102,105,103,0,0,0,0,0],extOffset=offset+37,contSize=size-37,contOffset=extOffset;if(cmpBytes(blob,extOffset,effectList28plusHeader)){extOffset+=effectList28plusHeader.length;var extSize=getUInt32(blob,extOffset);contOffset+=effectList28plusHeader.length+sizeInt+extSize,contSize=size-37-effectList28plusHeader.length-sizeInt-extSize,comp.codeEnabled=1===getUInt32(blob,extOffset+sizeInt);var initSize=getUInt32(blob,extOffset+2*sizeInt);comp.init=getSizeString(blob,extOffset+2*sizeInt)[0],comp.frame=getSizeString(blob,extOffset+3*sizeInt+initSize)[0]}var content=convertComponents(blob.subarray(contOffset,contOffset+contSize));return comp.components=content,comp}function decode_generic(blob,offset,fields,name,end){for(var comp={type:removeSpaces(name)},keys=Object.keys(fields),lastWasABitField=!1,i=0;i<keys.length&&!(offset>=end);i++){var k=keys[i],f=fields[k];if(k.match(/^null[_0-9]*$/))offset+=f,lastWasABitField=!1;else{var value,result,size=0,number="number"==typeof f,other="string"==typeof f;if(number){switch(f){case 1:size=1,value=blob[offset];break;case sizeInt:size=sizeInt,value=getUInt32(blob,offset);break;default:throw new ConvertException("Invalid field size: "+f+".")}lastWasABitField=!1}else if(other){try{result=window["get"+f](blob,offset)}catch(e){throw e.message.search(/has no method'/)>=0?new ConvertException("Method '"+f+"' was not found. (correct capitalization?)"):e}value=result[0],size=result[1],lastWasABitField=!1}else if(f&&f.length>=2){"Bit"===f[0]?(lastWasABitField&&(offset-=1),lastWasABitField=!0):lastWasABitField=!1;try{result=window["get"+f[0]](blob,offset,f[1]),value=result[0],f[2]&&(value=window["get"+f[2]](value))}catch(e){throw e.message.search(/has no method/)>=0?new ConvertException("Method '"+f+"' was not found. (correct capitalization?)"):e}size=result[1]}comp[k]=value,verbose&&log("k: "+k+", val: "+value+", offset: "+offset),offset+=size}}return comp}function decode_movement(blob,offset){var code,comp={type:"Movement"},effectIdOld=getUInt32(blob,offset),effect=[];if(0!==effectIdOld)if(32767===effectIdOld){var strAndSize=getSizeString(blob,offset+sizeInt+1);offset+=strAndSize[1],code=strAndSize[0]}else effect=movementEffects[effectIdOld];else{var effectIdNew=getUInt32(blob,offset+6*sizeInt);effect=movementEffects[effectIdNew]}return effect.length&&(comp.builtinEffect=effect[0]),comp.output=getUInt32(blob,offset+sizeInt)?"50/50":"Replace",comp.sourceMapped=getBool(blob,offset+2*sizeInt,sizeInt)[0],comp.coordinates=getCoordinates(blob,offset+3*sizeInt,sizeInt),comp.bilinear=getBool(blob,offset+4*sizeInt,sizeInt)[0],comp.wrap=getBool(blob,offset+5*sizeInt,sizeInt)[0],effect.length&&1!==effectIdOld&&7!==effectIdOld&&(code=effect[1],comp.coordinates=effect[2]),comp.code=code,comp}function decode_avi(blob,offset){var comp={type:"AVI",enabled:getBool(blob,offset,sizeInt)[0]},strAndSize=getNtString(blob,offset+3*sizeInt);comp.file=strAndSize[0],comp.speed=getUInt32(blob,offset+5*sizeInt+strAndSize[1]);var beatAdd=getUInt32(blob,offset+3*sizeInt+strAndSize[1]);return comp.output=beatAdd?"50/50":getMap8(blob,offset+sizeInt,{0:"Replace",1:"Additive",4294967296:"50/50"}),comp.onBeatAdd=beatAdd,comp.persist=getUInt32(blob,offset+4*sizeInt+strAndSize[1]),comp}function decode_simple(blob,offset){var comp={type:"Simple"},effect=getUInt32(blob,offset);if(64&effect)comp.audioSource=2&effect?"Waveform":"Spectrum",comp.renderType="Dots";else switch(3&effect){case 0:comp.audioSource="Spectrum",comp.renderType="Solid";break;case 1:comp.audioSource="Spectrum",comp.renderType="Lines";break;case 2:comp.audioSource="Waveform",comp.renderType="Lines";break;case 3:comp.audioSource="Waveform",comp.renderType="Solid"}return comp.audioChannel=getAudioChannel(effect>>2&3),comp.positionY=getPositionY(effect>>4&3),comp.colors=getColorList(blob,offset+sizeInt)[0],comp}function getMap1(blob,offset,map){return[getMapping(map,blob[offset]),1]}function getMap4(blob,offset,map){return[getMapping(map,getUInt32(blob,offset)),sizeInt]}function getMap8(blob,offset,map){return[getMapping(map,getUInt64(blob,offset)),2*sizeInt]}function getRadioButton(blob,offset,map){for(var key=0,i=0;i<map.length;i++){var on=0!==getUInt32(blob,offset+sizeInt*i);on&&(key=on*(i+1))}return[getMapping(map,key),sizeInt*map.length]}function getMapping(map,key){var value=map[key];if(void 0===value)throw new ConvertException("Map: A value for key '"+key+"' does not exist.");return value}function getCodePFBI(blob,offset){var map=[["init",3],["perFrame",1],["onBeat",2],["perPoint",0]];return getCodeSection(blob,offset,map)}function getCodeFBI(blob,offset){var map=[["init",2],["perFrame",1],["onBeat",0]];return getCodeSection(blob,offset,map)}function getCodeIFBP(blob,offset){var map=[["init",0],["perFrame",1],["onBeat",2],["perPoint",3]];return getCodeSection(blob,offset,map)}function getCodeIFB(blob,offset){var map=[["init",0],["perFrame",1],["onBeat",2]];return getCodeSection(blob,offset,map)}function getNtCodeIFB(blob,offset){var map=[["init",0],["perFrame",1],["onBeat",2]];return getCodeSection(blob,offset,map,!0)}function getNtCodeIFBP(blob,offset){var map=[["init",0],["perFrame",1],["onBeat",2],["perPoint",3]];return getCodeSection(blob,offset,map,!0)}function getCodeSection(blob,offset,map,nt){for(var strings=new Array(map.length),totalSize=0,i=0,p=offset;i<map.length;i++,p+=strAndSize[1]){var strAndSize=nt?getNtString(blob,p):getSizeString(blob,p);totalSize+=strAndSize[1],strings[i]=strAndSize[0]}for(var code={},i=0;i<strings.length;i++)code[map[i][0]]=strings[map[i][1]];return[code,totalSize]}function getColorList(blob,offset){for(var colors=[],num=getUInt32(blob,offset),size=sizeInt+num*sizeInt;num>0;)offset+=sizeInt,colors.push(getColor(blob,offset)[0]),num--;return[colors,size]}function getColorMaps(blob,offset){for(var mapOffset=offset+480,maps=[],headerSize=60,mi=0,i=0;8>i;i++){var enabled=getBool(blob,offset+headerSize*i,sizeInt)[0],num=getUInt32(blob,offset+headerSize*i+sizeInt),map=getColorMap(blob,mapOffset,num);if(enabled||2!==map.length||"#000000"!==map[0].color||0!==map[0].position||"#ffffff"!==map[1].color||255!==map[1].position){if(maps[mi]={index:i,enabled:enabled},allFields){var id=getUInt32(blob,offset+headerSize*i+2*sizeInt),mapFile=getNtString(blob,offset+headerSize*i+3*sizeInt)[0];maps[mi].id=id,maps[mi].fileName=mapFile}maps[mi].map=map,mi++}else;mapOffset+=num*sizeInt*3}return[maps,mapOffset-offset]}function getColorMap(blob,offset,num){for(var colorMap=[],i=0;num>i;i++){var pos=getUInt32(blob,offset),color=getColor(blob,offset+sizeInt)[0];offset+=3*sizeInt,colorMap[i]={color:color,position:pos}}return colorMap}function getColor(blob,offset){for(var color=getUInt32(blob,offset).toString(16),padding="",i=color.length;6>i;i++)padding+="0";return["#"+padding+color,sizeInt]}function getConvoFilter(blob,offset,dimensions){if(!(dimensions instanceof Array)&&2!==dimensions.length)throw new ConvertException("ConvoFilter: Size must be array with x and y dimensions in dwords.");for(var size=dimensions[0]*dimensions[1],data=new Array(size),i=0;size>i;i++,offset+=sizeInt)data[i]=getInt32(blob,offset)[0];var matrix={width:dimensions[0],height:dimensions[1],data:data};return[matrix,size*sizeInt]}function getSemiColSplit(str){var strings=str.split(";");return 1===strings.length?strings[0]:strings}function getBlendmodeIn(blob,offset,size){var code=1===size?blob[offset]:getUInt32(blob,offset);return[blendmodesIn[code],size]}function getBlendmodeOut(blob,offset,size){var code=1===size?blob[offset]:getUInt32(blob,offset);return[blendmodesOut[code],size]}function getBlendmodeBuffer(blob,offset,size){var code=1===size?blob[offset]:getUInt32(blob,offset);return[blendmodesBuffer[code],size]}function getBlendmodeRender(blob,offset,size){var code=1===size?blob[offset]:getUInt32(blob,offset);return[blendmodesRender[code],size]}function getBlendmodePicture2(blob,offset,size){var code=1===size?blob[offset]:getUInt32(blob,offset);return[blendmodesPicture2[code],size]}function getBlendmodeColorMap(blob,offset,size){var code=1===size?blob[offset]:getUInt32(blob,offset);return[blendmodesColorMap[code],size]}function getBlendmodeTexer(blob,offset,size){var code=1===size?blob[offset]:getUInt32(blob,offset);return[blendmodesTexer[code],size]}function getKeyColorMap(blob,offset,size){var code=1===size?blob[offset]:getUInt32(blob,offset);return[keysColorMap[code],size]}function getCycleModeColorMap(blob,offset,size){var code=1===size?blob[offset]:getUInt32(blob,offset);return[cycleModesColorMap[code],size]}function getBufferMode(blob,offset,size){var code=1===size?blob[offset]:getUInt32(blob,offset);return[buffermodes[code],size]}function getBufferNum(blob,offset,size){var code=1===size?blob[offset]:getUInt32(blob,offset);return 0===code?["Current",size]:[getUInt32(blob,offset),size]}function getCoordinates(blob,offset,size){var code=1===size?blob[offset]:getUInt32(blob,offset);return[coordinates[code],size]}function getDrawMode(blob,offset,size){var code=1===size?blob[offset]:getUInt32(blob,offset);return[drawModes[code],size]}function getAudioChannel(code){return audioChannels[code]}function getAudioSource(code){return audioSources[code]}function getPositionX(code){return positionsX[code]}function getPositionY(code){return positionsY[code]}function getMultiFilterEffect(code){return multiFilterEffect[code]}function saveAvsAsJson(preset,file){var json=convertPreset(preset,file),output="#output";$(output).html(JSON.stringify(json,null,prettyPrint?"    ":null)),$(output).each(function(i,e){hljs.highlightBlock(e)}),console.log("loaded:\n"+atob(json))}function jsonPrintSpecials(k,v){return"convolutionMatrix"===k?v.join(","):v}function SelectText(element){var doc=document,text=doc.getElementById(element);if(doc.body.createTextRange){var range=doc.body.createTextRange();range.moveToElementText(text),range.select()}else if(window.getSelection){var selection=window.getSelection(),range=doc.createRange();range.selectNodeContents(text),selection.removeAllRanges(),selection.addRange(range)}}var sizeInt=4,presetHeaderLength=25,builtinMax=16384,blendmodesIn={0:"Ignore",1:"Replace",2:"50/50",3:"Maximum",4:"Additive",5:"Dest-Src",6:"Src-Dest",7:"EveryOtherLine",8:"EveryOtherPixel",9:"XOR",10:"Adjustable",11:"Multiply",12:"Buffer"},blendmodesOut={0:"Replace",1:"Ignore",2:"Maximum",3:"50/50",4:"Dest-Src",5:"Additive",6:"EveryOtherLine",7:"Src-Dest",8:"XOR",9:"EveryOtherPixel",10:"Multiply",11:"Adjustable",13:"Buffer"},blendmodesBuffer={0:"Replace",1:"50/50",2:"Additive",5:"EveryOtherPixel",4:"Dest-Src",5:"EveryOtherLine",6:"XOR",7:"Maximum",8:"Minimum",9:"Src-Dest",10:"Multiply",11:"Adjustable"},blendmodesRender={0:"Replace",1:"Additive",2:"Maximum",3:"50/50",4:"Dest-Src",5:"Src-Dest",6:"Multiply",7:"Adjustable",8:"XOR"},blendmodesPicture2={0:"Replace",1:"Additive",2:"Maximum",3:"Minimum",4:"50/50",5:"Dest-Src",6:"Src-Dest",7:"Multiply",8:"XOR",9:"Adjustable",10:"Ignore"},blendmodesColorMap={0:"Replace",1:"Additive",2:"Maximum",3:"50/50",4:"Dest-Src",5:"Src-Dest",6:"Multiply",7:"Adjustable",8:"XOR"},blendmodesTexer={0:"Texture",1:"Masked Texture"},keysColorMap={0:"Red",1:"Green",2:"Blue",3:"(R+G+B)/2",4:"MaxChannel",5:"(R+G+B)/3"},cycleModesColorMap={0:"None (Map 1)",1:"OnBeat Random",2:"OnBeat Sequential"},buffermodes={0:"Save",1:"Restore",2:"AlternateSaveRestore",3:"AlternateRestoreSave"},coordinates={0:"Polar",1:"Cartesian"},drawModes={0:"Dots",1:"Lines"},audioChannels={0:"Left",1:"Right",2:"Center"},audioSources={0:"Waveform",1:"Spectrum"},positionsX={0:"Left",1:"Right",2:"Center"},positionsY={0:"Top",1:"Bottom",2:"Center"},multiFilterEffect={0:"Chrome",1:"Double Chrome",2:"Triple Chrome",3:"Infinite Root Multiplier + Small Border Convolution"},movementEffects={0:["None","",0],1:["Slight Fuzzify","",0],2:["Shift Rotate Left","x=x+1/32; // use wrap for this one",1],3:["Big Swirl Out","r = r + (0.1 - (0.2 * d));\r\nd = d * 0.96;",0],4:["Medium Swirl","d = d * (0.99 * (1.0 - sin(r-$PI*0.5) / 32.0));\r\nr = r + (0.03 * sin(d * $PI * 4));",0],5:["Sunburster","d = d * (0.94 + (cos((r-$PI*0.5) * 32.0) * 0.06));",0],6:["Swirl To Center","d = d * (1.01 + (cos((r-$PI*0.5) * 4) * 0.04));\r\nr = r + (0.03 * sin(d * $PI * 4));",0],7:["Blocky Partial Out","",0],8:["Swirling Around Both Ways At Once","r = r + (0.1 * sin(d * $PI * 5));",0],9:["Bubbling Outward","t = sin(d * $PI);\r\nd = d - (8*t*t*t*t*t)/sqrt((sw*sw+sh*sh)/4);",0],10:["Bubbling Outward With Swirl","t = sin(d * $PI);\r\nd = d - (8*t*t*t*t*t)/sqrt((sw*sw+sh*sh)/4);\r\nt=cos(d*$PI/2.0);\r\nr= r + 0.1*t*t*t;",0],11:["5 Pointed Distro","d = d * (0.95 + (cos(((r-$PI*0.5) * 5.0) - ($PI / 2.50)) * 0.03));",0],12:["Tunneling","r = r + 0.04;\r\nd = d * (0.96 + cos(d * $PI) * 0.05);",0],13:["Bleedin'","t = cos(d * $PI);\r\nr = r + (0.07 * t);\r\nd = d * (0.98 + t * 0.10);",0],14:["Shifted Big Swirl Out","d=sqrt(x*x+y*y); r=atan2(y,x);\r\nr=r+0.1-0.2*d; d=d*0.96;\r\nx=cos(r)*d + 8/128; y=sin(r)*d;",0,1],15:["Psychotic Beaming Outward","d = 0.15",0],16:["Cosine Radial 3-way","r = cos(r * 3)",0],17:["Spinny Tube","d = d * (1 - ((d - .35) * .5));\r\nr = r + .1;",0],18:["Radial Swirlies","d = d * (1 - (sin((r-$PI*0.5) * 7) * .03));\r\nr = r + (cos(d * 12) * .03);",0],19:["Swill","d = d * (1 - (sin((r - $PI*0.5) * 12) * .05));\r\nr = r + (cos(d * 18) * .05);\r\nd = d * (1-((d - .4) * .03));\r\nr = r + ((d - .4) * .13)",0],20:["Gridley","x = x + (cos(y * 18) * .02);\r\ny = y + (sin(x * 14) * .03);",1],21:["Grapevine","x = x + (cos(abs(y-.5) * 8) * .02);\r\ny = y + (sin(abs(x-.5) * 8) * .05);\r\nx = x * .95;\r\ny = y * .95;",1],22:["Quadrant","y = y * ( 1 + (sin(r + $PI/2) * .3) );\r\nx = x * ( 1 + (cos(r + $PI/2) * .3) );\r\nx = x * .995;\r\ny = y * .995;",1],23:["6-way Kaleida (use Wrap!)","y = (r*6)/($PI); x = d;",1]},builtinComponents=[{name:"Effect List",code:4294967294,group:"",func:"effectList"},{name:"Simple",code:0,group:"Render",func:"simple"},{name:"Dot Plane",code:1,group:"Render",func:"generic",fields:{rotationSpeed:"Int32",colorTop:"Color",colorHigh:"Color",colorMid:"Color",colorLow:"Color",colorBottom:"Color",angle:"Int32",null0:sizeInt}},{name:"Oscilliscope Star",code:2,group:"Render",func:"generic",fields:{audioChannel:["Bit",[2,3],"AudioChannel"],positionX:["Bit",[4,5],"PositionX"],null0:sizeInt-1,colors:"ColorList",size:sizeInt,rotation:sizeInt}},{name:"FadeOut",code:3,group:"Trans",func:"generic",fields:{speed:sizeInt,color:["Color",sizeInt]}},{name:"Blitter Feedback",code:4,group:"Misc",func:"generic",fields:{zoom:sizeInt,onBeatZoom:sizeInt,output:["Map4",{0:"Replace",1:"50/50"}],onBeat:["Bool",sizeInt],bilinear:["Bool",sizeInt]}},{name:"OnBeat Clear",code:5,group:"Render",func:"generic",fields:{color:"Color",output:["Map4",{0:"Replace",1:"50/50"}],clearBeats:sizeInt}},{name:"Blur",code:6,group:"Trans",func:"generic",fields:{blur:["Map4",{0:"None",1:"Medium",2:"Light",3:"Heavy"}],round:["Map4",{0:"Down",1:"Up"}]}},{name:"Bass Spin",code:7,group:"Trans",func:"generic",fields:{enabledLeft:["Bit",0,"Boolified"],enabledRight:["Bit",1,"Boolified"],null0:sizeInt-1,colorLeft:"Color",colorRight:"Color",mode:["Map4",{0:"Lines",1:"Triangles"}]}},{name:"Moving Particle",code:8,group:"Render",func:"generic",fields:{enabled:["Bit",0,"Boolified"],onBeatSizeChange:["Bit",1,"Boolified"],null0:sizeInt-1,color:"Color",range:sizeInt,size:sizeInt,onBeatSize:sizeInt,output:["Map4",{0:"Replace",1:"Additive",2:"50/50",3:"Default"}]}},{name:"Roto Blitter",code:9,group:"Trans",func:"generic",fields:{zoom:sizeInt,rotate:sizeInt,output:["map4",{0:"Replace",1:"50/50"}],onBeatReverse:["boolean",sizeInt],reversalSpeed:sizeInt,onBeatZoom:sizeInt,onBeat:["boolean",sizeInt],bilinear:["boolean",sizeInt]}},{name:"SVP",code:10,group:"Render",func:"generic",fields:{library:["SizeString",260]}},{name:"Colorfade",code:11,group:"Trans",func:"generic",fields:{enabled:["Bit",0,"Boolified"],onBeat:["Bit",2,"Boolified"],onBeatRandom:["Bit",1,"Boolified"],null0:sizeInt-1,fader1:"Int32",fader2:"Int32",fader3:"Int32",beatFader1:"Int32",beatFader2:"Int32",beatFader3:"Int32"}},{name:"Color Clip",code:12,group:"Trans",func:"generic",fields:{mode:["Map4",{0:"Off",1:"Below",2:"Above",3:"Near"}],colorFrom:"Color",colorTo:"Color",colorDistance:sizeInt}},{name:"Rotating Stars",code:13,group:"Render",func:"generic",fields:{colors:"ColorList"}},{name:"Ring",code:14,group:"Render",func:"generic",fields:{audioChannel:["Bit",[2,3],"AudioChannel"],positionX:["Bit",[4,5],"PositionX"],null0:sizeInt-1,colors:"ColorList",size:sizeInt,audioSource:["UInt32",sizeInt,"AudioSource"]}},{name:"Movement",code:15,group:"Trans",func:"movement"},{name:"Scatter",code:16,group:"Trans",func:"generic",fields:{enabled:["Bool",sizeInt]}},{name:"Dot Grid",code:17,group:"Render",func:"generic",fields:{colors:"ColorList",spacing:sizeInt,speedX:"Int32",speedY:"Int32",output:["Map4",{0:"Replace",1:"Additive",2:"50/50",3:"Default"}]}},{name:"Buffer Save",code:18,group:"Misc",func:"generic",fields:{mode:["BufferMode",sizeInt],buffer:["BufferNum",sizeInt],blend:["BlendmodeBuffer",sizeInt],adjustBlend:sizeInt}},{name:"Dot Fountain",code:19,group:"Render",func:"generic",fields:{rotationSpeed:"Int32",colorTop:"Color",colorHigh:"Color",colorMid:"Color",colorLow:"Color",colorBottom:"Color",angle:"Int32",null0:sizeInt}},{name:"Water",code:20,group:"Trans",func:"generic",fields:{enabled:["Bool",sizeInt]}},{name:"Comment",code:21,group:"Misc",func:"generic",fields:{text:"SizeString"}},{name:"Brightness",code:22,group:"Trans",func:"generic",fields:{enabled:["Bool",sizeInt],output:["Map8",{0:"Replace",1:"Additive",4294967296:"50/50"}],red:"Int32",green:"Int32",blue:"Int32",separate:["Bool",sizeInt],excludeColor:"Color",exclude:["Bool",sizeInt],distance:sizeInt}},{name:"Interleave",code:23,group:"Trans",func:"generic",fields:{enabled:["Bool",sizeInt],x:sizeInt,y:sizeInt,color:"Color",output:["Map8",{0:"Replace",1:"Additive",4294967296:"50/50"}],onbeat:["Bool",sizeInt],x2:sizeInt,y2:sizeInt,beatDuration:sizeInt}},{name:"Grain",code:24,group:"Trans",func:"generic",fields:{enabled:["Bool",sizeInt],output:["Map8",{0:"Replace",1:"Additive",4294967296:"50/50"}],amount:sizeInt,"static":["Bool",sizeInt]}},{name:"Clear Screen",code:25,group:"Render",func:"generic",fields:{enabled:["Bool",sizeInt],color:["Color",sizeInt],output:["Map8",{0:"Replace",1:"Additive",4294967296:"50/50",2:"Default"}],onlyFirst:["Bool",sizeInt]}},{name:"Mirror",code:26,group:"Trans",func:"generic",fields:{enabled:["Bool",sizeInt],topToBottom:["Bit",0,"Boolified"],bottomToTop:["Bit",1,"Boolified"],leftToRight:["Bit",2,"Boolified"],rightToLeft:["Bit",3,"Boolified"],null0:sizeInt-1,onBeat:["Bool",sizeInt],smooth:["Bool",sizeInt],speed:sizeInt}},{name:"Starfield",code:27,group:"Render",func:"generic",fields:{enabled:sizeInt,color:"Color",output:["Map8",{0:"Replace",1:"Additive",4294967296:"50/50"}],WarpSpeed:["Float32",sizeInt],MaxStars_set:sizeInt,onbeat:sizeInt,spdBeat:["Float32",sizeInt],durFrames:sizeInt}},{name:"Text",code:28,group:"Render",func:"generic",fields:{enabled:["Bool",sizeInt],color:["Color",sizeInt],output:["Map8",{0:"Replace",1:"Additive",4294967296:"50/50"}],onBeat:["Bool",sizeInt],insertBlanks:["Bool",sizeInt],randomPosition:["Bool",sizeInt],verticalAlign:["Map4",{0:"Top",4:"Center",8:"Bottom"}],horizontalAlign:["Map4",{0:"Left",1:"Center",2:"Right"}],onBeatSpeed:sizeInt,normSpeed:sizeInt,null0:60,null1:4*sizeInt,weight:["Map4",{0:"Dontcare",100:"Thin",200:"Extralight",200:"Ultralight",300:"Light",400:"Normal",400:"Regular",500:"Medium",600:"Semibold",600:"Demibold",700:"Bold",800:"Extrabold",800:"Ultrabold",900:"Heavy",900:"Black"}],italic:["Bool",1],underline:["Bool",1],strikeOut:["Bool",1],charSet:1,null2:4,fontName:["SizeString",32],text:["SizeString",0,"SemiColSplit"],outline:["Bool",sizeInt],outlineColor:"Color",shiftX:sizeInt,shiftY:sizeInt,outlineShadowSize:sizeInt,randomWord:["Bool",sizeInt],shadow:["Bool",sizeInt]}},{name:"Bump",code:29,group:"Trans",func:"generic",fields:{enabled:["Bool",sizeInt],onBeat:["Bool",sizeInt],duration:sizeInt,depth:sizeInt,onBeatDepth:sizeInt,output:["Map8",{0:"Replace",1:"Additive",4294967296:"50/50"}],code:"CodeFBI",showDot:["Bool",sizeInt],invertDepth:["Bool",sizeInt],null0:sizeInt,depthBuffer:["BufferNum",sizeInt]}},{name:"Mosaic",code:30,group:"Trans",func:"generic",fields:{enabled:["Bool",sizeInt],size:sizeInt,onBeatSize:sizeInt,output:["Map8",{0:"Replace",1:"Additive",4294967296:"50/50"}],onbeat:["Bool",sizeInt],durFrames:sizeInt}},{name:"Water Bump",code:31,group:"Trans",func:"generic",fields:{enabled:["Bool",sizeInt],density:sizeInt,depth:sizeInt,random:["Bool",sizeInt],dropPositionX:sizeInt,dropPositionY:sizeInt,dropRadius:sizeInt,method:sizeInt}},{name:"AVI",code:32,group:"Trans",func:"avi"},{name:"Custom BPM",code:33,group:"Misc",func:"generic",fields:{enabled:["Bool",sizeInt],mode:["RadioButton",{0:"Arbitrary",1:"Skip",2:"Reverse"}],arbitraryValue:sizeInt,skipValue:sizeInt,skipFirstBeats:sizeInt}},{name:"Picture",code:34,group:"Render",func:"generic",fields:{enabled:["Bool",sizeInt],output:["Map8",{0:"Replace",1:"Additive",4294967296:"50/50"}],adapt:sizeInt,onBeatPersist:sizeInt,file:"NtString",ratio:sizeInt,aspectRatioAxis:["Map4",{0:"X",1:"Y"}]}},{name:"Dynamic Distance Modifier",code:35,group:"Trans",func:"generic",fields:{null0:1,code:"CodePFBI",output:["Map4",{0:"Replace",1:"50/50"}],bilinear:["Bool",sizeInt]}},{name:"Super Scope",code:36,group:"Render",func:"generic",fields:{version:["Bool",1],code:"CodePFBI",audioChannel:["Bit",[0,1],"AudioChannel"],audioSource:["Bit",2,"AudioSource"],null0:3,colors:"ColorList",lineType:["DrawMode",sizeInt]}},{name:"Invert",code:37,group:"Trans",func:"generic",fields:{enabled:["Bool",sizeInt]}},{name:"Unique Tone",code:38,group:"Trans",func:"generic",fields:{enabled:["Bool",sizeInt],color:"Color",output:["Map8",{0:"Replace",1:"Additive",4294967296:"50/50"}],invert:["Bool",sizeInt]}},{name:"Timescope",code:39,group:"Render",func:"generic",fields:{enabled:["Bool",sizeInt],color:"Color",output:["Map8",{0:"Replace",1:"Additive",4294967296:"50/50",2:"Default"}],audioChannel:["UInt32",sizeInt,"AudioChannel"],bands:sizeInt}},{name:"Set Render Mode",code:40,group:"Misc",func:"generic",fields:{blend:["BlendmodeRender",1],adjustBlend:1,lineSize:1,enabled:["Bit",7,"Boolified"]}},{name:"Interference",code:41,group:"Trans",func:"generic",fields:{enabled:["Bool",sizeInt],numberOfLayers:sizeInt,null0:sizeInt,distance:sizeInt,alpha:sizeInt,rotation:"Int32",output:["Map8",{0:"Replace",1:"Additive",4294967296:"50/50"}],onBeatDistance:sizeInt,onBeatAlpha:sizeInt,onBeatRotation:sizeInt,separateRGB:["Bool",sizeInt],onBeat:["Bool",sizeInt],speed:"Float32"}},{name:"Dynamic Shift",code:42,group:"Trans",func:"generic",fields:{version:["Bool",1],code:"CodeIFB",output:["Map4",{0:"Replace",1:"50/50"}],bilinear:["Bool",sizeInt]}},{name:"Dynamic Movement",code:43,group:"Trans",func:"generic",fields:{version:["Bool",1],code:"CodePFBI",bilinear:["Bool",sizeInt],coordinates:["Coordinates",sizeInt],gridW:sizeInt,gridH:sizeInt,alpha:["Bool",sizeInt],wrap:["Bool",sizeInt],buffer:["BufferNum",sizeInt],alphaOnly:["Bool",sizeInt]}},{name:"Fast Brightness",code:44,group:"Trans",func:"generic",fields:{factor:["Map4",{0:2,1:.5,2:1}]}},{name:"Color Modifier",code:45,group:"Trans",func:"generic",fields:{recomputeEveryFrame:["Bool",1],code:"CodePFBI"}}],dllComponents=[{name:"AVS Trans Automation",code:[77,105,115,99,58,32,65,86,83,84,114,97,110,115,32,65,117,116,111,109,97,116,105,111,110,0,0,0,0,0,0,0],group:"Misc",func:"generic",fields:{enabled:["Bool",sizeInt],logging:["Bool",sizeInt],translateFirstLevel:["Bool",sizeInt],readCommentCodes:["Bool",sizeInt],code:"NtString"}},{name:"Texer",code:[84,101,120,101,114,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],group:"Misc",func:"generic",fields:{null0:4*sizeInt,image:["SizeString",260],input:["Bit",0,"BlendmodeIn"],output:["Bit",2,"BlendmodeTexer"],null1:3,particles:sizeInt,null2:4}},{name:"Texer II",code:[65,99,107,111,46,110,101,116,58,32,84,101,120,101,114,32,73,73,0,0,0,0,0,0,0,0,0,0,0,0,0,0],group:"Render",func:"generic",fields:{null0:sizeInt,image:["SizeString",260],resizing:["Bool",sizeInt],wrap:["Bool",sizeInt],coloring:["Bool",sizeInt],null1:sizeInt,code:"CodeIFBP"}},{name:"Color Map",code:[67,111,108,111,114,32,77,97,112,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],group:"Trans",func:"generic",fields:{key:["KeyColorMap",sizeInt],output:["BlendmodeColorMap",sizeInt],mapCycling:["CycleModeColorMap",sizeInt],null0:2,dontSkipFastBeats:["Bool",1],cycleSpeed:1,maps:"ColorMaps"}},{name:"Framerate Limiter",code:[86,70,88,32,70,82,65,77,69,82,65,84,69,32,76,73,77,73,84,69,82,0,0,0,0,0,0,0,0,0,0,0],group:"Misc",func:"generic",fields:{enabled:["Bool",sizeInt],limit:sizeInt}},{name:"Convolution Filter",code:[72,111,108,100,101,110,48,51,58,32,67,111,110,118,111,108,117,116,105,111,110,32,70,105,108,116,101,114,0,0,0,0],group:"Misc",func:"generic",fields:{enabled:["Bool",sizeInt],wrap:["Bool",sizeInt],absolute:["Bool",sizeInt],"2-pass":["Bool",sizeInt],kernel:["ConvoFilter",[7,7]],bias:"Int32",scaling:"Int32"}},{name:"Triangle",code:[82,101,110,100,101,114,58,32,84,114,105,97,110,103,108,101,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],group:"Misc",func:"generic",fields:{code:"NtCodeIFBP"}},{name:"Channel Shift",code:[67,104,97,110,110,101,108,32,83,104,105,102,116,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],group:"Misc",func:"generic",fields:{mode:["Map4",{1144:"RGB",1020:"RBG",1019:"BRG",1021:"BGR",1018:"GBR",1022:"GRB"}],onBeatRandom:["Bool",sizeInt]}},{name:"Normalize",code:[84,114,97,110,115,58,32,78,111,114,109,97,108,105,115,101,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],group:"Trans",func:"generic",fields:{enabled:["Bool",sizeInt]}},{name:"Video Delay",code:[72,111,108,100,101,110,48,52,58,32,86,105,100,101,111,32,68,101,108,97,121,0,0,0,0,0,0,0,0,0,0,0],group:"Trans",func:"generic",fields:{enabled:["Bool",sizeInt],useBeats:["Bool",sizeInt],delay:sizeInt}},{name:"Multiplier",code:[77,117,108,116,105,112,108,105,101,114,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],group:"Trans",func:"generic",fields:{multiply:["Map4",{0:"Infinite Root",1:8,2:4,3:2,4:.5,5:.25,6:.125,7:"Infinite Square"}]}},{name:"Color Reduction",code:[67,111,108,111,114,32,82,101,100,117,99,116,105,111,110,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],group:"Trans",func:"generic",fields:{null0:260,colors:["Map4",{1:2,2:4,3:8,4:16,5:32,6:64,7:128,8:256}]}},{name:"Multi Delay",code:[72,111,108,100,101,110,48,53,58,32,77,117,108,116,105,32,68,101,108,97,121,0,0,0,0,0,0,0,0,0,0,0],group:"Trans",func:"generic",fields:{mode:["Map4",{0:"Disabled",1:"Input",2:"Output"}],activeBuffer:sizeInt,useBeats0:["Bool",sizeInt],delay0:sizeInt,useBeats1:["Bool",sizeInt],delay1:sizeInt,useBeats2:["Bool",sizeInt],delay2:sizeInt,useBeats3:["Bool",sizeInt],delay3:sizeInt,useBeats4:["Bool",sizeInt],delay4:sizeInt,useBeats5:["Bool",sizeInt],delay5:sizeInt}},{name:"MIDI Trace",code:[78,117,108,108,115,111,102,116,32,80,105,120,101,108,99,111,114,112,115,58,32,77,73,68,73,116,114,97,99,101,32,0],group:"Misc",func:"generic",fields:{enabled:["Bool",sizeInt],channel:sizeInt,mode:["Map4",{1:"Current",2:"Trigger"}],allChannels:["Bool",sizeInt],printEvents:["Bool",sizeInt]}},{name:"Add Borders",code:[86,105,114,116,117,97,108,32,69,102,102,101,99,116,58,32,65,100,100,98,111,114,100,101,114,115,0,0,0,0,0,0],group:"Misc",func:"generic",fields:{enabled:["Bool",sizeInt],color:"Color",size:sizeInt}},{name:"AVI Player",code:[86,70,88,32,65,86,73,32,80,76,65,89,69,82,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],group:"Misc",func:"generic",fields:{filePath:["SizeString",256],enabled:["Bool",sizeInt]}},{name:"FyrewurX",code:[70,117,110,107,121,70,88,32,70,121,114,101,119,117,114,88,32,118,49,0,0,0,0,0,0,0,0,0,0,0,0,0],group:"Misc",func:"generic",fields:{enabled:["Bool",sizeInt]}},{name:"Global Variables",code:[74,104,101,114,105,107,111,58,32,71,108,111,98,97,108,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],group:"Misc",func:"generic",fields:{load:["Map4",{0:"None",1:"Once",2:"CodeControl",3:"EveryFrame"}],null0:6*sizeInt,code:"NtCodeIFB",file:"NtString",saveRegRange:"NtString",saveBufRange:"NtString"}},{name:"Fluid",code:[71,101,105,115,115,70,108,117,105,100,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],group:"Misc",func:"generic",fields:{null0:sizeInt}},{name:"Picture II",code:[80,105,99,116,117,114,101,32,73,73,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],group:"Misc",func:"generic",fields:{image:["NtString",260],output:["BlendmodePicture2",sizeInt],onBeatOutput:["BlendmodePicture2",sizeInt],bilinear:["Bool",sizeInt],onBeatBilinear:["Bool",sizeInt],adjustBlend:sizeInt,onBeatAdjustBlend:sizeInt}},{name:"MultiFilter",code:[74,104,101,114,105,107,111,32,58,32,77,85,76,84,73,70,73,76,84,69,82,0,0,0,0,0,0,0,0,0,0,0],group:"Misc",func:"generic",fields:{enabled:["Bool",sizeInt],effect:["multiFilterEffect",sizeInt],onBeat:["Bool",sizeInt],null0:["Bool",sizeInt]}}],componentTable=builtinComponents.concat(dllComponents),compat=!1,outputDir="",pedanticMode=!1,verbose=!0,allFields=!0,prettyPrint=!0;
$(document).ready(function(){checkCompat(),log("File API check: "+(compat?"success":"fail")+".");var files=[];$("#preset").change(function(){files=loadDir(this,/\.avs$/),log("Found "+files.length+" files in directory.");for(var i=0;i<files.length;i++)loadFile(files[i],saveAvsAsJson)})}),hljs.initHighlightingOnLoad(),$(function(){$("#output").click(function(){SelectText("output")})});